var apphitsApi;(function(n){function t(n,t,i){var u=r.getInstance();u.logHit(n,t,i)}n.logHit=t;var i=function(){function n(n){this.rootDate=n;this.deltas=[]}return n.prototype.logHit=function(n){var t=n.getTime()-this.rootDate.getTime();this.deltas.push(t)},n}(),r=function(){function n(){if(!n._allowCons)throw new Error("Only one instance of AppHitsClient can be initialized - call static getInstance method");n._allowCons=!1;this.numHits=0;this.isShutdown=!1;this.hits={};var t=this;this.intervalId=setInterval(t.flushAtInterval,3e5)}return n.getInstance=function(){return n._instance==null&&(n._allowCons=!0,n._instance=new n,$(window).unload(null,n._instance.shutdown)),n._instance},n.prototype.logHit=function(t,i,r){var u=n._instance,f,e;if(u.isShutdown){console.log("AppHitsClient is shutdown - hit was not logged. App:",i," Feature:",r);return}f=new Date;e=u.getFeatureHit(f,t,i,r);e.logHit(f);u.numHits++;u.numHits>=20&&(clearInterval(u.intervalId),u.flushAll(),u.intervalId=setInterval(u.flushAtInterval,3e5))},n.prototype.shutdown=function(){var t=n._instance;t.isShutdown=!0;clearInterval(t.intervalId);t.flushAll();n._instance=null},n.prototype.flushAtInterval=function(){var t=n._instance;console.log("AppHitsClient - flush interval elapsed");t.flushAll()},n.prototype.flushAll=function(){var t=n._instance,r,i;if(t.numHits<1){console.log("AppHitsClient - nothing to flush");return}r=t.hits;i=t.numHits;t.hits={};t.numHits=0;console.log("AppHitsClient - flushing hits. Batch size:",i);$.ajax({type:"POST",url:"/Apps/AppHitsSvc/SendHits",data:JSON.stringify(r)}).then(function(n,t){console.log("AppHitsClient - logged hits batch. Count:",i,"| Status:",t)},function(n,t,r){console.log("AppHitsClient - failed logging hits batch: ",t,"| Error:",r);console.log("AppHitsClient -",i,"dropped")})},n.prototype.getFeatureHit=function(t,r,u,f){var h=n._instance,o=h.hits[r],e,s;return o||(o={},h.hits[r]=o),e=o[u],e||(e={},o[u]=e),s=e[f],s||(s=new i(t),e[f]=s),s},n._instance=null,n._allowCons=!1,n}()})(apphitsApi||(apphitsApi={}));